<?xml version="1.0" encoding="utf-8"?>
<configuration>
<system.webServer>
  <rewrite>
    <rules>
      <!-- API pass-through (keep as you already have it) -->
      <rule name="PlexProxyApiCatchAll" stopProcessing="true">
        <match url="^plexproxy/api/(.*)$" />
        <action type="Rewrite"
                url="https://bridges-shop.tailc97a23.ts.net/api/{R:1}"
                appendQueryString="true"
                logRewrittenUrl="true" />
      </rule>

      <!-- Raw thumbs / art -->
      <rule name="PlexLibraryAssets" stopProcessing="true">
        <match url="^plexproxy/library/(.+)$" />
        <action type="Rewrite"
                url="https://bridges-shop.tailc97a23.ts.net/library/{R:1}"
                appendQueryString="true"
                logRewrittenUrl="true" />
        <serverVariables>
          <set name="HTTP_X-Plex-Token" value="sYTiqbeXxy13sjNDdviM" />
        </serverVariables>
      </rule>

      <!-- Photo transcode fallback -->
      <rule name="PlexPhotoTranscode" stopProcessing="true">
        <match url="^plexproxy/photo/(.+)$" />
        <action type="Rewrite"
                url="https://bridges-shop.tailc97a23.ts.net/photo/{R:1}"
                appendQueryString="true"
                logRewrittenUrl="true" />
        <serverVariables>
          <set name="HTTP_X-Plex-Token" value="sYTiqbeXxy13sjNDdviM" />
        </serverVariables>
      </rule>

      <rule name="MusicToPlaylist" stopProcessing="true">
        <match url="^music$" />
        <conditions logicalGrouping="MatchAll" trackAllCaptures="false" />
        <action type="Rewrite" url="/player.html" appendQueryString="true" />
      </rule>
    </rules>
  </rewrite>

  <!-- Keep ARR proxy toggles; optionally: keep redirects same-origin -->
  <!-- appcmd: set system.webServer/proxy /reverseRewriteHostInResponseHeaders:"True" -->
</system.webServer>
</configuration>